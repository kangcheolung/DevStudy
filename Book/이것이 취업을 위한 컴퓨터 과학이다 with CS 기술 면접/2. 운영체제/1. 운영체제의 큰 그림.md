# 운영체제의 큰 그림

## 운영체제

운영체제의 핵심 기능을 담당하는 부분을 **커널**이라고 한다. 커널은 마치 자동차의 엔진이나 사람의 심장과도 같은 핵심부라고 할 수 있다.  만약 특별한 언급이 없다면 이번 장에서는 ‘운영체제’라는 용어는 ‘커널’을 지칭한다고 이해하면 된다. 

## 운영체제의 핵심 기능

1. 자원 할당 및 관리
2. 프로세스 및 스레드 관리 

# 운영체제의 역할

운영체제의 핵심 기능인 ‘자원(혹은 시스템 자원)’이란 프로그램 실행에 마땅히 필요한 요소를 의미한다. 
ex) 실행에 필요한 ‘데이터’를 자원(소프트웨어)이라고 하기도하고, 실행에 필요한 ‘부품’을 자원(하드웨어)이라고 하기도 한다. 

운영체제는 사용자가 실행하는 응용 프로그램을 대신하여 CPU, 메모리, 보조기억장치 등의 컴퓨터 부품에 접근하고, 각각의 부품들이 효율적으로 사용되도록 관리한다. 또한 응용 프로그램이 컴퓨터 부품들을 효율적으로 할당받아 문제 없이 실행할 수 있도록 응용 프로그램에게 자원을 할당한다. 

## CPU 관리: CPU 스케줄링

CPU는 한정된 자원이기 때문에 CPU를 할당받아 사용하기 위해 때로는 다른 프로그램의 CPU 사용이 끝날 때까지 기다려야한다. 그래서 운영체제는 실행 중인 모든 프로그램들이 공정하고 합리적으로 CPU를 할당받도록 CPU의 할당 순서와 사용 시간을 결정한다. 이것이 CPU 스케줄링이다. 

## 메모리 관리: 가상 메모리

운영체제는 새롭게 실행하는 프로그램을 메모리에 적재하고, 종료된 프로그램을 메모리에서 삭제한다. 동시에 낭비되는 메모리 용량이 없도록 효율적으로 관리해야한다. 오늘날 존재하는 많은 운영체제들은 이를 위해 가상 메모리 기술을 활용한다. 
5절에서 학습할 ‘가상메모리’는 운영체제의 관리 기법 중 하나로, 실제 물리적인 메모리 크기보다 더 큰 메모리를 이용할 수 있도록 하는 기술이다. 

## 파일/디렉터리 관리: 파일 시스템

운영체제는 보조기억장치를 효율적으로 관리하기 위해 파일 시스템을 활용한다. 
파일 시스템은 보조기억장치 내의 정보를 파일 및 폴더(디렉터리 단위로 접근 * 관리할 수 있도록 만드는 운영체제 내부 프로그램이다. 

## 프로세스 및 스레드 관리

지금까지는 프로세스는 ‘실행 중인 프로그램’이라하고, 스레드는 ‘프로세스를 이루는 실행의 단위’라고 했다. 
메모리에는 여러 프로세스가 적재될 수 있는데, 운영체제는 이 프로세스에 필요한 자원을 할당하고, 스레드는 프로세스가 할당받은 자원을 이용해 프로세스의 작업을 수행한다. 프로세스가 이루는 스레드가 둘 이상인 경우에는 동일한 작업을 동시에 실행할 수도 있다. 

운영체제는 이렇게 동시다발적으로 실행되는 프로세스와 스레드가 올바르게 처리되도록 실행의 순서를 제어하고, 프로세스와 스레드가 요구하는 자원을 적절하게 배분할 수 있어야 한다. 

# 시스템 콜과 이중 모드

운영체제도 일종의 프로그램이기 때문에 프로그램이 실행되기 위해서는 반드시 메모리에 적재되어야 한다. 다만, 사용자는 프로그램과는 달리 운영체제는 메우 특별한 프로그램이므로 메모리 내외 ‘**커널 영역’**이라는 공간에 따로 적재되어 실행된다. 
운영체제가 적재되는 커널 영역 외에 사용자 응용 프로그램이 적재되는 공간은 ‘**사용자 영역’**이라고 한다.

### 시스템 콜

응용 프로그램은 시스템 콜을 호출하여 운영체제 코드를 실행할 수 있다. 
시스템 콜은 운영체제의 서비스를 제공받기 위한 수단으로, 호출 가능한 함수의 형태를 가진다.   
운영체제에 따라 제공하는 시스템 콜의 종류와 개수는 다양하다. 

### 소프트웨어 인터럽트

운영체제에는 인터럽트를 발생시키는 특정 명령어가 있다. 자원에서 접근하는 입출력 명령어가 대표적이며, 이러한 명령어에 의해 발생하는 인터럽트를 ‘소프트웨어 인터럽트’ 라고한다. 

시스템 콜이 바로 이 소프트웨어 인터럽트의 일종이다. 

실행과정

1. 사용자 영역을 실행하는 과정에서 시스템 콜이 호출되면 여느 인터럽트와 마찬가지로 CPU는 현재 수행 중인 작업을 백업한다.
2. 커널 영역 내의 인터럽트를 처리하기 위한 코드(시스템 콜을 구성하는 코드)를 실행한 뒤
3. 다시 사용자 영역의 코드 실행을 재개한다. 

또 CPU는 명령어를 실행하는 과정에서 사용자 영역을 실행할 때의 모드와 커널 영역을 실행할 때의 모드를 구분하여 실행한다. 
이때 사용자 영역에 적재된 코드를 실행할 때의 실행 모드를 **사용자 모드**라 하고, 커널 영역에 적재된 코드를 실행할 때의 실행 모드를 **커널 모드**라고 한다. 그리고 이렇게 2개의 모드를 구분하여 실행하는 것을 **이중 모드**라고 한다. 

### 사용자 모드

사용자 모드는 운영체제 서비스를 제공받을 수 없는 실행모드로, 커널 영역의 코드를 실행할 수 없는 모드이다. 

- 사용자 모드로 실행 중인 CPU는 입출력 명령어와 같이 자원에 접근하는 명령어를 만나도 이를 실행하지 않는다.
- 덕분에 사용자 모드로 실행되는 명령어는 실수로라도 자원에 접근할 수 없다

### 커널 모드

커널 모드는 운영체제 서비스를 제공받을 수 있는 실행 모드로, 커널 영역의 코드를 실행할 수 있는 모드이다. 

- CPU가 커널 모드로 명령어를 실행하면 자원에 접근하는 명령어를 비롯한 모든 명령어를 실행할 수 있다.
- 운영체제는 이 커널 모드로 실행되기 때문에 자원에 접근할 수 있는 것이다.