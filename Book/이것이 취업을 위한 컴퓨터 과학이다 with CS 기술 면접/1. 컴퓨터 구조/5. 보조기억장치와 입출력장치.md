# 보조기억장치와 입출력장치

## RAID

대중적으로 활용되고 있는 보조기억장치는 하드 디스크 드라이브와 플래시 메모리 기반 저장장치로 크게 두 가지이다. 

### 하드 디스크

하드 디스크는 자기적인 방식으로 데이터를 읽고 쓰는 보조기억장치이다. 하드디스크에 있는 동그란 원판은 플래터이고, 원판 위에 있는 뾰족한 리더기인 헤드를 통해 플래터에 저장된 데이터에 접근 할 수 있다. 

### 플래시 메모리

플래시 메모리는 전기적인 방식으로 데이터를 읽고 쓰는 반도체 기반의 저장장치이다. USB 메모리, SD카드, SSD 모두 플래시 메모리 기반 저장장치이고, 이 중  보조기억장치로 주로 사용되는 플래시 메모리는 SSD이다. 

보조기억장치의 본분은 크게 2가지이다. 하나는 전원이 꺼져도 데이터를 안전하게 보관하는 것이고, 또 하나는 CPU가 필요로 하는 정보를 조금이라도 빠른 성능으로 메모리에게 전달하는 것이다. 

RAID는 데이터의 안전성 혹은 성능을 확보하기 위해 여러 개의 독립적인 보조기억장치를 마치 하나의 보조기억장치처럼 사용하는 기술을 의미한다. 

RAID를 구성하는 방법에는 여러가지가 있으며, RAID 레벨이라고 한다. 가장 많이 사용되는 것은 RAID0, RAID1, RAID4, RAID5, RAID6이다.

 

### RAID0

RAID0은 데이터를 여러 보조기억장치에 단순하게 나누어 저장하는 구성방식이다. 분산되어 저장되는 데이터를 스트라입이라고하고, 분산하여 저장하는 동작을 스트라이핑이라고 한다. 

장점

RAID0의 장점은 빠른 입출력 속도이다. 하나의 대용량 저장장치를 이용했다면 여러 번에 걸쳐서 읽고 써야 했을 데이터를 한 번에, 동시에 읽고 쓸 수 있기 때문이다. 

단점

저장된 정보가 안전하지 않다는 것이다. 

![image.png](%EB%B3%B4%EC%A1%B0%EA%B8%B0%EC%96%B5%EC%9E%A5%EC%B9%98%EC%99%80%20%EC%9E%85%EC%B6%9C%EB%A0%A5%EC%9E%A5%EC%B9%98/image.png)

### RAID1

RAID1는 완전한 복사본을 만들어 저장하는 구성 방식이다. 이를 미러링이라고 부른다. 

장점

- 복구가 간단하고 안전성이 높다

단점

- 어떤 데이터를 쓸 때는 원본과 복사본 두 곳에 써야하기 때문에 RAID0보다 쓰기 속도가 느려진다.
- RAID1은 복사본이 저장된 크기 만큼 사용 가능한 용량이 적어진다.

![image.png](%EB%B3%B4%EC%A1%B0%EA%B8%B0%EC%96%B5%EC%9E%A5%EC%B9%98%EC%99%80%20%EC%9E%85%EC%B6%9C%EB%A0%A5%EC%9E%A5%EC%B9%98/image%201.png)

### RAID4

RAID4는 패리티 정보를 저장하는 디스크를 따로 두는 구성 방식이다. 여기서 패리티는 오류를 검출 할 수 있는 정보를 말한다. 

장점

- RAID4를 통해 오류 검출용 장치를 따로 두면 RAID1에 비해 적은 하드 디스크로 안전하게 데이터를 보관이 가능함

단점

- 패리티를 저장하는 장치에 병목 현상이 발생한다는 것이다.

![image.png](%EB%B3%B4%EC%A1%B0%EA%B8%B0%EC%96%B5%EC%9E%A5%EC%B9%98%EC%99%80%20%EC%9E%85%EC%B6%9C%EB%A0%A5%EC%9E%A5%EC%B9%98/image%202.png)

### RAID5

RAID5는 패리티를 분산하여 저장하는 구성 방식이다. 패리티를 분산하면 RAID4의 단점인 병목 현상을 보완이 가능하다. 

![image.png](%EB%B3%B4%EC%A1%B0%EA%B8%B0%EC%96%B5%EC%9E%A5%EC%B9%98%EC%99%80%20%EC%9E%85%EC%B6%9C%EB%A0%A5%EC%9E%A5%EC%B9%98/image%203.png)

### RAID6

RAID6은 구성은 RAID5와 같지만, 서로 다른 2개의 패리티를 두는 구성 방식이다. 오류를 검출하고 복구할 수 있는 수단이 2개가 생긴 셈이다. 

장점

- RAID6은 RAID4, RAID5에 비해 안전성이 높다.

단점

- 새로운 정보를 저장할 때마다 함께 저장할 패리티가 2개이므로 RAID5에 비해 쓰기 속도는 일반적으로 느리다.

---

## 입출력 기법

입출력 장치는 CPU와 직접 연결되어 정보를 주고 받지 않고, 장치 컨트롤러라는 하드웨어를 통해 연결된다. 모든 입출력장치는 각자의 장치 컨트롤러를 통해 컴퓨터 내부와 연결되어 정보를 주고 받는다. 

### 장치 컨트롤러

장치 컨트롤러는 CPU와 입출력장치 사이의 통신을 중개하는 역할의 하드웨어인 셈이다. CPU는가 직접 하드 디스크를 회전 시키거나 마이크의 입력 값을 해석하고, 프런터를 작동시키는 것이 아니라, 장치 컨트롤러의 중개를 통해 입출력장치가 작동하는 것이다. 

### 장치 드라이버

장치 드라이버는 장치 컨트롤러의 동작을 알고, 장치 컨트롤러가 컴퓨터 내부와정보를 주고 받을 수 있도록 하는 프로그램이다. 컴퓨터가 장치드라이버를 인식하지 못한다면 장치 컨트롤러와 정보를 주고 받는 방법을 알 수 없으므로 입출력장치를 실행하지 못할 것이다. 

장치 컨트롤러가 정보를 주고 받는 작업은 크게 프로그램 입출력, 인터럽트 기반 입출력, DMA 입출력이다. 

## 프로그램 입출력

프로그램 입출력으 프로그램 속 명령어로 입출력 작업을 수행하는 방법이다. CPU는 “프린터 컨트롤러의 상태를 확인하라”, “하드 디스크 컨트롤러에 10을써라”와 같은 입출력 명령어를 실행함으로써 장치 컨트롤러와 상호작용하고, 이를 통해 입출력 작업을 수행한다. 

## 인터럽트 기반 입출력: 다중 인터럽트

### 다중 인터럽트 처리

인터럽트가 동시다발적으로 발생하는 경우에는 기본적으로 인터럽트 서비스 루틴을 순차적으로 실행한다. 

CPU는 플래그 레지스터 속 인터럽트 비트가 활성화 되는 경우, 혹은 인터럽트 비트가 비활성화해도 무시할 수 없는 인터럽트인 NMI가 발생한 경우, 이렇게 우선순위가 높은 인터럽트부터 먼저 처리한다. 

## PIC(프로그래머블 인터럽트 컨트롤러)

PIC는 여러 장치 컨트롤러에 연결되어 장치 컨트롤러에서 보낸 하드웨어 인터럽트 요청들의 우선순위를 판별한 뒤, CPU에게 지금 처리해야 할 하드웨어 인터럽트가 무엇인지 알려 주는 장치이다. 

PIC에는 여러 핀들이 있는 각각의 핀에는 CPU에게 하드웨어 인터럽트 요청을 보낼 수 있도록 약속된 하드웨어가 연결되어 있다. 

## DMA 입출력

프로그램 기반의 입출력과 인터럽트 기반의 입출력에 공통점은 CPU가 입출력장치와 메모리 간의 데이터 이동을 주도해야하며, 이동하는 데이터들도 반드시 CPU를 거친다는 점이다. 

그래서 CPU를 거치지 않고 입출력 장치와 메모리가 상호작용 할 수 있는 입출력 방식인 DMA가 등장했다.

DMA는 직접 메모리에 접근할 수 있는 입출력 기능을 말한다. 

### DMA 입출력 과정

1. CPU가 DMA 컨트롤러에게 입출력장치와 주소, 수행할 연산, 연산할 메모리 주소 등의 정보와 함께 입출력 작업을 명령한다. 
2. DMA 컨트롤러가 CPU 대신 장치 컨트롤러와 상호작용하며 입출력 작업을 수행한다. 이때 DMA 컨트롤러는 필요한 경우 메모리에 직접 접근하여 정보를 읽거나 쓴다. 입출력장치와 메모리 사이에 주고 받을 데이터가 CPU를 거치지 않는다. 
3. DMA 컨트롤러는 입출력 작업이 끝나면 CPU에게 인터럽트를 걸어 작업이 끝났음을 알린다. 

## PCIe

PCIe 버스는 PCI라는 입출력 버스의 발전된 형태로, 오늘날의 메인 모드에서 가장 대중적으로 볼 수 있는 입출력 버스 중 하나이다. 

PCIe와 연결된 장치의 성능과 알아야할 내용은 크게 2가지이다. 

1. PCIe 버전에 따라 최대 속도가 달라질 수 있다
2. PCIe 버스가 여러 레인을 이용해 정보를 주고 받을 수 있다.